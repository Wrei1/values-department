rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Public inquiries (create) + authenticated admin management
    match /inquiries/{docId} {
      allow create: if request.resource.data.keys().hasAll([
          'fullName',
          'email',
          'phone',
          'serviceType',
          'message',
          'status',
          'createdAt',
          'inquiryNumber'
        ])
        && request.resource.data.status == 'pending';
      allow read, update, delete: if request.auth != null;
    }

    // Counter document for sequential inquiry numbers
    match /meta/counters {
      allow get: if true;
      allow list: if false;
      allow create: if request.resource.data.keys().hasOnly(['inquiries'])
        && request.resource.data.inquiries == 1;
      allow update: if request.resource.data.keys().hasOnly(['inquiries'])
        && request.resource.data.inquiries == resource.data.inquiries + 1;
    }
  }
}
